@{
    Layout = null;
    var CurrentUser = (SysUser)ViewBag.CurrentUser;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>@MvcApplication.Title</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="shortcut icon" href="@Url.Content("~/favicon.ico")" type="image/x-icon" />
    <link rel="stylesheet" href="/layui/css/layui.css" media="all" />
    <link rel="stylesheet" href="//at.alicdn.com/t/font_tnyc012u2rlwstt9.css" media="all" />
    <link rel="stylesheet" href="/css/main.css" media="all" />
    <style>
        .layui-nav-more{
            display:none!important;
        }
    </style>
</head>
<body class="main_body">
    <div class="layui-layout layui-layout-admin">
        <!-- 顶部 -->
        <div class="layui-header header">
            <div class="layui-main">
                <span class="logo" style="width: auto;">
                    <img src="@Url.Content("~/images/login1.png")" width="32" height="32" style="width: 32px; height: 32px;" alt="" title="" />
                    爱拜尔科技有限公司
                </span>
                <!-- 显示/隐藏菜单 -->
                <a href="javascript:;" class="iconfont hideMenu icon-menu1"></a>


                <!-- 顶部右侧菜单 -->
                <ul class="layui-nav top_menu">

                    <li class="layui-nav-item" pc>
                        <a href="javascript:;">
                            <img src="@SysUserBll.GetAvatar(CurrentUser)" class="layui-circle" width="35" height="35">
                            <cite>@CurrentUser.Name</cite>
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a href="javascript:;" onclick="PersonInfo();"><i class="iconfont icon-zhanghu" data-icon="icon-zhanghu"></i><cite>个人资料</cite></a></dd>
                            <dd><a href="javascript:;" onclick="ChangePassword();"><i class="iconfont icon-shezhi1" data-icon="icon-shezhi1"></i><cite>修改密码</cite></a></dd>
                            <dd><a href="javascript:;" class="changeSkin"><i class="iconfont icon-huanfu"></i><cite>更换皮肤</cite></a></dd>
                            <dd><a href="/Login/Logout" class="signOut"><i class="iconfont icon-loginout"></i><cite>退出</cite></a></dd>
                        </dl>
                    </li>
                </ul>
            </div>
        </div>
        <!-- 左侧导航 -->
        <div class="layui-side layui-bg-black">
            <div class="user-photo">
                <a class="img" title="我的头像"><img src="@SysUserBll.GetAvatar(CurrentUser)"></a>
                <p>你好！<span class="userName">@CurrentUser.Name</span></p>
            </div>
            <div class="navBar layui-side-scroll"></div>
        </div>
        <!-- 右侧内容 -->
        <div class="layui-body layui-form">
            <div class="layui-tab layui-tab-card marg0" lay-filter="bodyTab" id="top_tabs_box">
                <ul class="layui-tab-title top_tab" id="top_tabs">
                    <li class="layui-this" lay-id=""><i class="layui-icon layui-icon-home"></i> <cite>后台首页</cite></li>
                </ul>
                <ul class="layui-nav closeBox">
                    <li class="layui-nav-item">
                        <a href="javascript:;"><i class="iconfont icon-caozuo"></i> 页面操作</a>
                        <dl class="layui-nav-child">
                            <dd><a href="javascript:;" class="refresh refreshThis"><i class="layui-icon">&#x1002;</i> 刷新当前</a></dd>
                            <dd><a href="javascript:;" class="closePageOther"><i class="iconfont icon-prohibit"></i> 关闭其他</a></dd>
                            <dd><a href="javascript:;" class="closePageAll"><i class="iconfont icon-guanbi"></i> 关闭全部</a></dd>
                        </dl>
                    </li>
                </ul>
                <div class="layui-tab-content clildFrame">
                    <div class="layui-tab-item layui-show">
                        @*<iframe src="/Home/Main"></iframe>*@
                    </div>
                </div>
            </div>
        </div>
        <!-- 底部 -->
        <div class="layui-footer footer">
            <p>
                Copyright &copy; 爱拜尔科技有限公司 2020
            </p>
        </div>
    </div>

    <!-- 移动导航 -->
    <div class="site-tree-mobile layui-hide"><i class="layui-icon">&#xe602;</i></div>
    <div class="site-mobile-shade"></div>

    <input type="hidden" id="hidLeftModuleId" name="hidLeftModuleId" value="" />
    <input type="hidden" id="hidLeftParentId" name="hidLeftParentId" value="" />
    <script type="text/javascript" src="/layui/layui.js"></script>
    <script type="text/javascript" src="/js/nav.js"></script>
    <script type="text/javascript" src="/js/index.js?v=1"></script>
    <script src="~/Scripts/jquery-3.4.1.min.js?@MvcApplication.Version"></script>
    <script src="~/Scripts/aibibase.js?@MvcApplication.Version"></script>
    <script>
        var tabsid = 0;
        var lastTab;
        function addTab(name, url) {
            name = name == null ? null : $.trim(name);
            url = $$.toOpenUrl(url, name);
            tab.addTab(name, url);
            return;
            name = name == null ? null : $.trim(name);
            url = $$.toOpenUrl(url, name);
            var obj = findTab(name);
            if (!obj) {
                obj = newTab(name, url);
            } else {
                obj.page.find("iframe").attr("src", url);
            }
            obj.page.find("div.shade").show();

            activeTab(obj);
        }
        function hideAllTab() {
            $("#Navs-Home").parent().find(">li>a.nav-link").removeClass("active").attr("aria-selected", "false");
            $("#Tabs-Home").parent().find(">div.tab-pane").removeClass("active").removeClass("show");
        }
        function newTab(name, url) {
            tabsid++;
            if (!name) {
                name = "新窗口" + tabsid;
            }
            name = name == null ? null : $.trim(name);
            var tab = $($("#tabtemplate").html()).attr("Id", "Navs-" + (tabsid)).attr("tabname", name);
            tab.find(">a").attr("href", "#Tabs-" + tabsid).html(" " + name + '<button class="tab-btn-close"></button>');
            var page = $($("#pagetemplate").html()).attr("Id", "Tabs-" + tabsid).attr("tabname", name);
            page.find(">iframe").attr("src", url).on("load", function () {
                $(this).next("div.shade").fadeOut(300);
            });

            tab.find("button").on("click", closeTab);
            tab.appendTo($("#Navs-Home").parent());
            page.appendTo($("#Tabs-Home").parent());
            return { tab: tab, page: page };
        }
        function findTab(name) {
            var tab, page,layid;
            if (typeof name == "string") {
                name = name == null ? null : $.trim(name);
                layid = window.tab.getLayId(name);
            } else if (typeof name == "number") {
                layid = name;
            } else {
                tab = $();
                page = $();
                return null;
            }
            tab = $("li[lay-id=" + layid + "]");
            let dataid = tab.find("i[data-id]").attr("data-id");
            page = $("iframe[data-id=" + dataid + "]").closest("div.layui-tab-item");

            if (tab.length <= 0) {
                return null;
            }
            return { tab: tab, page: page };
        }
        function activeTab(obj) {
            lastTab = getActiveTab();
            hideAllTab();
            var tab = obj.tab;
            var page = obj.page;
            tab.find(">a").addClass("active").attr("aria-selected", "true");
            page.addClass("active").addClass("show");

            var outleft = $("#navbar-menu").scrollLeft();
            var outright = outleft + $("#navbar-menu").width();
            var inleft = tab.position().left;
            var inright = inleft + tab.outerWidth();
            if (inleft >= outleft + 66 && inright <= outright - 66) {
                return;
            }
            let offset;
            if (inleft - outleft > outright - inright) {
                offset = inright - $("#navbar-menu").width() + 56;
            } else {
                offset = inleft - 66;
            }
            $("#scrollul").parent().animate({ "scrollLeft": offset }, 100);
            //window.ActiveTab = obj;
        }
        function removeTab(obj) {
            let currentTab = getActiveTab();
            var tab = obj.tab;
            var page = obj.page;
            var tabindex = tab.index();
            var thisName = tab.attr("tabname");
            tab.remove();
            page.remove();
            if (currentTab.tab.attr("tabname") != thisName) {

                return;
            }
            var obj = findTab(tabindex);
            if (obj) {
                activeTab(obj);
                return;
            }
            obj = findTab(tabindex - 1);
            if (obj) {
                activeTab(obj);
                return;
            }
            obj = findTab(0);
            if (obj) {
                activeTab(obj);
                return;
            }
        }
        function getActiveTab() {
            var name = $("#Navs-Home").parent().find("a.active").closest("[tabname]").attr("tabname");
            return findTab(name);
        }
        function closeTab(e) {
            removeTab(findTab($(this).closest("[tabname]").attr("tabname")));
        }
        //$(function () {
        //    //$("#scrollul").on("mousedown", function (e) {
        //    //    //if (e.target.tagName == "BUTTON") {
        //    //    //    return;
        //    //    //}
        //    //    this.mousedown = {
        //    //        x: e.clientX + $(document).scrollLeft(),
        //    //        scroll: $(this).parent().scrollLeft(),
        //    //        target: e.target
        //    //    };
        //    //    $(this).css("pointer-events", "none");
        //    //    $("iframe").css("pointer-events", "none");
        //    //});
        //    //$(document).on("mousemove.scrollul", function (e) {
        //    //    if (!$("#scrollul")[0].mousedown) {
        //    //        return;
        //    //    }

        //    //    var offsetX = e.clientX + $(document).scrollLeft() - $("#scrollul")[0].mousedown.x;
        //    //    if (Math.abs(offsetX) > 3) {
        //    //        $("#scrollul")[0].mousedown.moving = true;
        //    //    }
        //    //    var scrollX = $("#scrollul")[0].mousedown.scroll;
        //    //    $("#scrollul").parent().scrollLeft(scrollX - offsetX);
        //    //    //console.log(offsetX);
        //    //}).on("mouseup.scrollul", function () {
        //    //    var mousedown = $("#scrollul")[0].mousedown;
        //    //    if (!mousedown) {
        //    //        return;
        //    //    }
        //    //    if (!mousedown.moving && ($(mousedown.target).hasClass("nav-link") || mousedown.target.tagName == "svg")) {
        //    //        var name = $(mousedown.target).closest(".nav-item").attr("tabname");
        //    //        activeTab(findTab(name));
        //    //    }
        //    //    if (!mousedown.moving && ($(mousedown.target)[0].tagName == "BUTTON")) {
        //    //        var name = $(mousedown.target).closest(".nav-item").attr("tabname");
        //    //        removeTab(findTab(name));
        //    //    }
        //    //    delete $("#scrollul")[0].mousedown;
        //    //    $("#scrollul,iframe").css("pointer-events", "auto");
        //    //})
            

        //});
    </script>
    @Html.Partial("ChangePass")
    @Html.Partial("PersonInfo")
</body>
</html>
